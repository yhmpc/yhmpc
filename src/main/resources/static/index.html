<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>小明的自留地</title>
    <link rel="stylesheet" href="./css/index.css">
    <link rel="stylesheet" href="./fonts/iconfont.css">
    <script src="./js/axios.js"></script>
    <script src="./js/template-web.js"></script>
    <style>
    .icon-fangdajing {
        color:#333;
    }
    </style>
</head>
<body>
   <div class="container">
       <!-- 头部 -->
       <div class="head">
           <h1>小明的自留地</h1>
           <i>网站暂停更新，所有访问和解压密码均为：yhmpc2016，望知悉！</i>
       </div>
       <!-- 内容主体 -->
       <div class="main clearfix">
           <!-- 导航栏 -->
           <div class="nav">
             <ul>
                 <!-- <li><a href="#">首页</a></li>
                 <li><a href="#">windows</a></li>
                 <li><a href="#">网络技术</a></li>
                 <li><a href="#">Office</a></li>
                        <li class="target"><a href="#">Adobe</a>
                                <ul>
                                    <li><a href="#">PS</a></li>
                                    <li><a href="#">AE</a></li>
                                </ul>
                            </li>
                        <li class="target"><a href="#">软件相关</a>
                                <ul>
                                    <li><a href="#">大型软件</a></li>
                                    <li><a href="#">小型软件</a></li>
                                    <li><a href="#">小众运用</a></li>
                                </ul>
                            </li>
                 <li><a href="#">关于</a></li> -->
             </ul>
           </div>
           <div class="content clearfix">
               <!-- 左边的文章内容 -->
            <div class="left">
              <!-- <div class="item">
                  <h4><a href="#">Corel VideoStudio Pro X8 - 会声会影 X8</a></h4>
                  <div class="time">
                    <span>2016-08-03</span>&nbsp;&nbsp;<a href="#">AE</a>
                  </div>
                  <img src="./images/BSJ4g.jpg" alt="">
                 
                  <div class="tags">
                        标签: <a href="#">VideoStudioProX8</a> <a href="#">会声会影X8</a> <a href="#">会声会影X8汉化</a>
                  </div>
                  <div class="read">
                        <a href="">评论(0)</a> <a href="">浏览(13656)</a>
                  </div>
              </div> -->
            </div>
               <!-- 分页器 -->
            <div class="page">
                    <ul>
                        <!-- <li class="active">1</li>
                        <li>2</li> -->
                    </ul>
            </div>
            <!-- 右边的搜索栏 -->
            <div class="right">
              <h5>搜索</h5>
              <div class="search">
                  <i class="iconfont icon-fangdajing"></i><input type="text">
              </div>
              <div class="article">
                 <h5>热门文章</h5>
                  <ul>
                      <li><i class="iconfont icon-jiantou1"></i><a href="">Microsoft Office 2016专业增强版（附激活）</a></li>
                      <li><i class="iconfont icon-jiantou1"></i><a href="">Excel 修改权限密码（无需破解软件）</a></li>
                      <li><i class="iconfont icon-jiantou1"></i><a href="">PDF编辑器：Adobe Acrobat XI Pro（附破解补丁）</a></li>
                      <li><i class="iconfont icon-jiantou1"></i><a href="">Excel 修改权限密码（无需破解软件）</a></li>
                      <li><i class="iconfont icon-jiantou1"></i><a href="">Excel 修改权限密码（无需破解软件）</a></li>
                      <li><i class="iconfont icon-jiantou1"></i><a href="">迅雷下载百度云大文件（最新方法，亲测有效）</a></li>
                      <li><i class="iconfont icon-jiantou1"></i><a href="">PDF编辑器：Adobe Acrobat XI Pro（附破解补丁）</a></li>
                      <li><i class="iconfont icon-jiantou1"></i><a href="">迅雷下载百度云大文件（最新方法，亲测有效）</a></li>
                  </ul>
              </div>
              <div class="article">
                    <h5>小伙伴</h5>
                    <ul>
                        <li><i class="iconfont icon-jiantou1"></i><a href="">程序猿</a></li>
                        <li><i class="iconfont icon-jiantou1"></i><a href="">国军博客</a></li>
                        <li><i class="iconfont icon-jiantou1"></i><a href="">Hackhp Blog</a></li>
                        <li><i class="iconfont icon-jiantou1"></i><a href="">+申请友链+</a></li>
                       
                    </ul>
                </div>
            </div>
           </div>
           <!-- 底部 -->
           <div class="bottom">
                ©2014-2016 小明的自留地 <a href="">鄂ICP备14009486号</a>
            </div>
       </div>
   </div>

</body>
<!-- 模板--导航栏-->
<script type="text/html" id="mytemp">
    {{each data}}
    {{if $value.isHide=='n'&&$value.subNavigations.length==0}}
    <li><a href="index.html">{{$value.naviname}}</a></li>
    {{else if $value.isHide=='n'&&$value.subNavigations.length!=0}}
    <li class="target"><a href="index.html">{{$value.naviname}}</a>
        <ul>
            {{each $value.subNavigations}}
            <li><a href="index.html">{{$value.naviname}}</a></li>
            {{/each}}
        </ul>
    </li>
    {{/if}}
    {{/each}}
</script>
<!-- 模板--文章列表 -->
<script type="text/html" id="mytemp2">
   {{each data}}
   <div class="item">
        <h4><a href="#">{{$value.title}}</a></h4>
        <div class="time">
          <span>{{$value.createTime | dateFormat}}</span>&nbsp;&nbsp;<a href="#">{{$value.sortName}}</a>
        </div>
        <img src="{{$value.excerpt}}" alt="">
       
        <div class="tags">
              标签: 
             {{each $value.tags}}
             <a href="#">{{$value}}</a> 
             {{/each}}
        </div>
        <div class="read">
              <a href="">评论(0)</a> <a href="">浏览({{$value.viewNum}})</a>
        </div>
    </div>
   {{/each}}
</script>
<!-- 模板-分页 -->
<script type="text/html" id="tempPage">
    {{each}}
    <li>{{$value}}</li>
    {{/each}}
</script>

<!-- <script src="./js/index.js"></script> -->
<script>
    var total;//文章总条数
    var pageSize;//页容量
    // 注册一个过滤器
    template.defaults.imports.dateFormat = function(date, format){
        var time=new Date(date);
        var year=time.getFullYear();
        var month=time.getMonth()+1;
        var day=time.getDate();
        month=month<10?'0'+month:month;
        day=day<10?'0'+day:day;
        return year+'-'+month+'-'+day;
    };
    //发请求获取导航栏数据
 axios.get('http://192.168.31.130:8080/navigations').then(res=>{
        if(res.data.code===20000){
            // console.log(res);
        //调用template,创建元素
        var html = template('mytemp',res.data);
        // console.log(html)
        }
        document.getElementsByClassName('nav')[0].children[0].innerHTML=html;
    })
    //发请求获取首页文章列表
    axios.get('http://192.168.31.130:8080/articles/p/1').then(res=>{
        // console.log(res);
        // 文章列表
        var html=template('mytemp2',res.data.data);
        // console.log(html);
        document.getElementsByClassName('content')[0].children[0].innerHTML=html;
        total=res.data.data.total;//文章总条数
        pageSize=res.data.data.data.length;//一页显示多少条文章
        var totalPage=Math.ceil(total/pageSize);
        //循环产生数字,存到数组
        var arr=[];
        for(var i=1;i<=totalPage;i++){
            arr.push(i)
        }
        var result=template('tempPage',arr);
        document.getElementsByClassName('page')[0].children[0].innerHTML=result;
    })
    //给页码添加点击事件
    var page=document.getElementsByClassName('page')[0];
    page.addEventListener('click',function(event){
        if(event.target.nodeName=='LI'){
        var currentPage=event.target.innerText;
          // 排除法
        var liList=document.getElementsByClassName('page')[0].children[0].children;
        // console.log(liList)
        for(var i=0;i<liList.length;i++){
            liList[i].className='';
        }
        //加上active类
        event.target.className="active";
      
        axios.get('http://192.168.31.130:8080/articles/p/'+currentPage).then(res=>{
        // console.log(res);
        // 文章列表
        var html=template('mytemp2',res.data.data);
        // console.log(html);
        document.getElementsByClassName('content')[0].children[0].innerHTML=html;
        //滚动条滚动到顶部
        window.scrollTo(0,0);
        })
    }
    })
    
    
</script>
</html>